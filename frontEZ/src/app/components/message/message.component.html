<p>message works!</p>

<div id="box"></div>
<input type="text" placeholder="Message" id="input" />
<button id="btn" onclick="sendMessage()">send</button>

<script>
  let socket = new WebSocket("ws://localhost:8080");

  // get username
  let username = prompt("Enter your username:");

  //ws message
  socket.onmessage = function (event) {
    let REQUEST = JSON.parse(event.data);

    // clear box
    document.getElementById("box").innerHTML = "";

    //add all message
    for (let req of REQUEST["msg"]) {
      addMessageBox[req];
    }
  };

  // handle connections
  socket.onopen = function () {
    console.warn("Connection open");
  };

  // handle disconnections
  socket.onclose = function () {
    console.warn("Connection closed");
  };
  // handle errors
  socket.onerror = function (error) {
    console.error("WebSocket Error:", error);
  };

  // send username to server
  socket.send(JSON.stringify({ type: "username", username }));

  // // handle incoming messages
  // socket.onmessage = function (event) {
  //   let data = JSON.parse(event.data);

  //   if (data.type === "message") {
  //     document.getElementById(
  //       "box"
  //     ).innerHTML += `<p><strong>${data.username}:</strong> ${data.message}</p>`;
  //   } else if (data.type === "userlist") {
  //     document.getElementById("box").innerHTML += `<p>Users: ${data.users.join(
  //       ", "
  //     )}</p>`;
  //   }}

  // // send message when button is clicked
  // function sendMessage() {
  //   let message = document.getElementById("input").value;
  //   if (message) {
  //     socket.send(JSON.stringify({ type: "message", message }));
  //     document.getElementById("input").value = "";
  //   }};

  function getInputValue() {
    //get text
    const INPUT = document.getElementById("input");
    let value = //clear input
      (INPUT.INPUT.value = "");

    // return input value
    if (value.trim() != "") {
      return value;
    } else {
      return null;
    }

    function sendMessage() {
      //get value from input
      let inputValue = getInputValue();
      if (inputValue) {
        let msg = {
          name: username,
          msg: inputValue,
        };
        ws.send(JSON.stringify(msg));
      }
    }
  }

  function addMessageBox(request) {
    // get content request
    request = JSON.parse(request);

    //get element and create element
    const BOX = document.getElementById("box");
    let newEl = document.createElement("div");
    let name = document.createElement("p");
    let msg = document.createElement("p");

    //add id and classe
    newEl.className = "messages";
    name.id = "name";
    msg.id = "msg";

    //add content in html element
    newEl.appendChild(name);
    newEl.appendChild(msg);
    //add div in box messages
    BOX.appendChild(newEl);

    //scroll to
    BOX.scrollTop = BOX.scrollHeight;
  }
</script>
